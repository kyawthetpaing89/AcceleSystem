@model Models.Print_GenkaModel
@{
    ViewBag.Title = "Print_Genka";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string loginUser = Session["UserInfo"].ToString();
    string LoginID = string.Empty;

    if (!string.IsNullOrEmpty(loginUser))
    {
        LoginID = loginUser.Split('_')[0].ToString();
    }

}

<style>
    #tblExcel tr th, #tblExcel tr td {
        border: 1px solid #808080;
    }

        #tblExcel tr th:first-child {
            width: 550px;
        }

        #tblExcel tr td:first-child {
            width: 50px;
        }

        #tblExcel tr td:nth-child(2) {
            width: 300px;
        }

        #tblExcel tr td:nth-child(3) {
            width: 200px;
        }

    #tblExcel tr th, #tblExcel tr td {
        width: 100px;
    }
</style>

@section Styles{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/bootstrap-textbox.css")" />
}
<div id="divMain" class="container-fluid">
    <div class="content">
        <div class="p-5 row shadow" style="box-shadow: 0 .1rem .4rem rgba(0,0,0,.1) !important; background:white; border-radius:5px;">
            <div class="col-xs-12 col-md-3"></div>
            <div class="col-xs-12 col-md-7">
                <div>
                    <h2 class=" hr-text text-center">原価集計表</h2>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="1" class="text-line col-xl-4 text-left" id="targetyear" onkeydown="KeyDown(event,this)" maxlength="4" placeholder="対象年度">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="2" class="text-line col-xl-3 text-left" id="BrandCD" name="brandcd" onkeydown="KeyDown(event,this,'BrandCheck')" maxlength="6" style="width:140px;" placeholder="ブランド名">
                            <input id="btnPSearch" type="button" value="..." onclick="Search(1)" />
                            <label id="BrandName"  style="text-transform: none;"><b>@*ブランド表示*@</b></label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div id="Seasongp" class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:20px;">シーズン</label>
                            <input type="checkbox" tabindex="3" id="allyear" name="chk" value="1" onkeydown="KeyDown(event,this)" checked>
                            <label for="allyear" style="padding-right:20px!important;">通年</label>
                            <input type="checkbox" tabindex="4" id="SS" name="chk" value="2" onkeydown="KeyDown(event,this)" checked>
                            <label for="SS" style="padding-right:20px!important;">SS</label>
                            <input type="checkbox" tabindex="5" id="FW" name="chk" value="3" onkeydown="KeyDown(event,this,'SeasonCheck')" checked>
                            <label for="FW" style="padding-right:20px!important;">FW</label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:20px;">プロジェクト</label>
                            <input type="text" tabindex="6" class="text-line col-xl-3 text-left" id="proCD" name="projectcd" onkeydown="KeyDown(event,this)" maxlength="15" required placeholder="入力">
                            <input type="button" id="btnProjectSearch" value="..." onclick="Search(6)" />
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:116px;"></label>
                            <input type="text" id="proName" tabindex="7" class="text-line col-xl-8 text-left" onkeydown="KeyDown(event,this)" required placeholder="入力" maxlength="60">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:20px;">納品状況</label>
                            <input type="checkbox" tabindex="8" id="deliver" name="chk" onkeydown="KeyDown(event,this)" checked>
                            <label for="deliver" style="padding-right:20px!important;">納品残あり</label>
                            <input type="checkbox" tabindex="9" id="undeliver" name="chk" onkeydown="KeyDown(event,this,'flgCheck')">
                            <label for="undeliver" style="padding-right:20px!important;">完納</label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12" style="padding-left:110px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <button id="btnGenerate" tabindex="10" onclick="btnGenerateClick()" class="btn btn-dark col-xl-5 text-center">処理実行</button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            @*<button id="btnCancel" tabindex="11" onclick="btnCancelClick()" class="btn btn-primary col-xl-5 text-center">戻る</button>*@
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-md-3"></div>
        </div>
        <div class="col-md-12">
            <table id="tblExcel" style="display:none;">
                <thead></thead>
                <tbody></tbody>
            </table>
            <a id="dlink" style="display:none;"></a>
        </div>
    </div>
</div>
@Html.Partial("~/Views/Search/SearchBase.cshtml")
<script src="@Url.Content("~/ElaAdmin/assets/js/Brand.js")"></script>
<script src="@Url.Content("~/ElaAdmin/assets/js/Search.js")"></script>
<script src="@Url.Content("~/ElaAdmin/assets/js/Project.js")"></script>
@section Scripts{
    @*<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>*@
    <script src="~/Scripts/jquery.table2excel.js"></script>
    <script type="text/css" src="@Url.Content("~/Scripts/jquery.table2excel.js")">
    </script>
    <script type="text/javascript" src="https://unpkg.com/xlsx@0.16.9/dist/shim.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/xlsx/dist/xlsx.mini.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/blob.js@1.0.1/Blob.js"></script>
    <script type="text/javascript" src="https://unpkg.com/file-saver@1.3.3/FileSaver.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#formtitle").text("原価集計表");
            $("#targetyear").attr('disabled', 'disabled');
            $("#BrandCD").focus();
            var Mode = '@Model.Mode';
            if (Mode == 'New') {
               // $('#btnGenerate').html('登録');

                @*RequiredCheck($("#targetyear"));
                DoubleByteCheck($("#targetyear"), '@Url.Action("DoubleByte_Checking", "api/CommonApi")');
                YearCheck($("#targetyear"), '@Url.Action("Year_Checking", "api/CommonApi")');*@

                //RequiredCheck($("#BrandCD"));
                DoubleByteCheck($("#BrandCD"), '@Url.Action("DoubleByte_Checking", "api/CommonApi")');
                ExistsCheck($("#BrandCD"), "Brand", '@Url.Action("M_Brand_ExistsCheck", "api/Print_GenkaApi")', "BrandName");

                //RequiredCheck($("#projectCD"));
                DoubleByteCheck($("#proCD"), '@Url.Action("DoubleByte_Checking", "api/CommonApi")');
                ExistsCheck($("#proCD"), "Project", '@Url.Action("M_Project_ExistsCheck", "api/Print_GenkaApi")', "proName");

                ShowTargetYear();
            }
            $("#divSearch").iziModal({
            top: 50,
            width: "80%",
            overlayClose: false,
            zindex: 1000,
        });
        });

        function ShowTargetYear() {
            var Pmodel = {
                TargetYear: $("#targetyear").val(),
            };

            var data = CalltoApiController('@Url.Action("M_Contrl_Year_ExitCheck", "api/Print_GenkaApi")', Pmodel);
            var controldata = JSON.parse(data);
            //alert(controldata[0].FiscalYear);
            if (controldata[0].FiscalYear)
                $("#targetyear").val(controldata[0].FiscalYear);
            else
                ShowErrorMessage("E101");
        }

        function doit(type, fn, dl) {    //ptk Added onclick="doit('xlsx');"
            var elt = document.getElementById('tblExcel');
            var wb = XLSX.utils.table_to_book(elt, { sheet: "原価集計表" });
            return dl ?
                XLSX.write(wb, { bookType: type, bookSST: false, type: 'base64' }) :
                XLSX.writeFile(wb, fn || ('原価集計表.' + (type || 'xlsx')));
        }

        function BrandCheck(result) {    // Make bold to BrandName after databind
            if (result == 'OK' && $("#BrandCD").val()) {
                $("#BrandName").css("font-weight", "Bold");
            }
            else $("#BrandName").text('');
            $("#BrandName").css("font-weight", "Bold");
        }

        function SeasonCheck(result) {
            if (result == 'OK') {
                var allyear = $("#allyear").is(":checked");
                var ss = $("#SS").is(":checked");
                var fw = $("#FW").is(":checked");
                if (!allyear && !ss && !fw) {
                    $("#FW").focus();
                    ShowErrorMessage("E111");
                }
            }
        }

        function flgCheck(result) {
            if (result == 'OK') {
                if (!$("#deliver").is(":checked") && !$("#undeliver").is(":checked")) {
                    $("#undeliver").focus();
                    ShowErrorMessage("E111");
                }
            }
        }

        function btnGenerateClick() {
            var allyear = $("#allyear").is(":checked");
            var ss = $("#SS").is(":checked");
            var fw = $("#FW").is(":checked");
            if (!allyear && !ss && !fw) {
                $("#FW").focus();
                var data = ShowErrorMessage("E111");
                return data;
            }
            else if (!$("#deliver").is(":checked") && !$("#undeliver").is(":checked")) {
                $("#undeliver").focus();
                ShowErrorMessage("E111");
            }
            else {
                var res = ErrorCheckOnSave();
                var brandname;
                if ($("#BrandName").text() == 'ブランド表示')
                    brandname = '';
                else
                    brandname = $("#BrandName").text();

                if (res == "0") {
                    var pmodel = {
                        TargetYear: $("#targetyear").val(),
                        BrandCD: $("#BrandCD").val(),
                        BrandName: brandname,
                        ProjectCD: $("#proCD").val(),
                        ProjectName: $("#proName").val(),
                        LoginID: '@LoginID'
                    };
                    var selected = new Array();
                    $("#Seasongp input[type=checkbox]:checked").each(function () {
                        selected.push(this.value);
                    });
                    if (selected.length > 0)
                        pmodel.Season = selected.join(",");

                    if ($('#deliver').is(':checked'))
                        pmodel.DeliveryStatus = "1";
                    else if ($('#undeliver').is(':checked'))
                        pmodel.DeliveryStatus = "2";

                    var data = CalltoApiController('@Url.Action("Print_GenkaCSV", "api/Print_GenkaApi")', pmodel);
                    //var csv = JSON2CSV(data);
                    //var downloadLink = document.createElement("a");
                    //var blob = new Blob(["\ufeff", csv]);
                    //var url = URL.createObjectURL(blob);
                    //downloadLink.href = url;
                    //downloadLink.download = "原価集計表.csv";

                    //document.body.appendChild(downloadLink);
                    //downloadLink.click();
                    //document.body.removeChild(downloadLink);

                        var res = JSON2CSV(data);
                        if (res == "E131") {
                            ShowErrorMessage(res);
                        } else {
                            download();


                            ShowTargetYear();
                            $("#BrandCD").val('');
                            $("#BrandName").text('');
                            $("#BrandName").css("font-weight", "Bold");
                            $('#allyear').prop('checked', true);
                            $('#SS').prop('checked', true);
                            $('#FW').prop('checked', true);
                            $("#proCD").val('');
                            $("#proName").val('');
                            $('#deliver').prop('checked', true);
                            $('#undeliver').prop('checked', false);
                        }
                }
                else {
                    $("#BrandCD").focus();
                    ShowErrorMessage(res);
                }
            }
        }


        //Convert Jsonstring to csv
        function JSON2CSV(objArray) {
            if (!(objArray == "[]")) {
                var fiscalMM;
                var i, b, result = [];
                var array = typeof JSONString != 'object' ? JSON.parse(objArray) : JSONString;
                var replacer = function (key, value) { return value === null ? '' : value }
                if (array.length > 0) {
                    fiscalMM = array[0]["FiscalMM"];
                    var colname = ["", "前期発生金額", "1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月", "当期配賦金額", "費目合計", "当期仕掛金額"]
                    $('#tblExcel thead').append($('<tr>'));
                    for (var i = 0; i <= colname.length - 1; i++) {
                        if (i == 0) {
                            $('#tblExcel thead tr:last').append($("<th colspan='3' style = 'font-weight: bold;color: white;background-color: #000099; text-align: right;'>"));
                        }
                        else {
                            $('#tblExcel thead tr:last').append($("<th style = 'font-weight: bold;color: white;background-color: #000099'>"));
                        }

                        if ('0' + colname[i].slice(0, -1) == fiscalMM) {
                            $('#tblExcel thead tr>th:last').html("★　" + colname[i] + "　★");
                        }
                        else {
                            $('#tblExcel thead tr>th:last').html(colname[i]);
                        }
                    }
                    var add_row, a_row = 0, o_row = 0, isrowspan = 0;
                    for (i = 0; i < array.length; i++) {
                        if (array[i]["SortKey"] == '10') {
                            if (a_row == 0) {
                                add_row = '<td rowspan = ' + array[i]["Row_Count"] + ' style="text-align: center; vertical-align: middle;">' + array[i]["BrandCD"] + '</td><td>' + "'" + array[i]["Casting"] + '</td><td>' + array[i]["CostName"] + '</td><td>' + replaceZero(array[i]["CostPre"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost1"]) + '</td><td>' + replaceZero(array[i]["Cost2"]) + '</td><td>' + replaceZero(array[i]["Cost3"]) + '</td><td>' + replaceZero(array[i]["Cost4"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost5"]) + '</td><td>' + replaceZero(array[i]["Cost6"]) + '</td><td>' + replaceZero(array[i]["Cost7"]) + '</td><td>' + replaceZero(array[i]["Cost8"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost9"]) + '</td><td>' + replaceZero(array[i]["Cost10"]) + '</td><td>' + replaceZero(array[i]["Cost11"]) + '</td><td>' + replaceZero(array[i]["Cost12"]) + '</td><td>' +
                                    replaceZero(array[i]["CostHaihu"]) + '</td><td>' + commaSeparate(array[i]["CostHimoku"]) + '</td><td>' + commaSeparate(array[i]["CostShikakari"]) + '</td>';
                            }
                            else {
                                add_row = '<td>' + "'" + array[i]["Casting"] + '</td><td>' + array[i]["CostName"] + '</td><td>' + replaceZero(array[i]["CostPre"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost1"]) + '</td><td>' + replaceZero(array[i]["Cost2"]) + '</td><td>' + replaceZero(array[i]["Cost3"]) + '</td><td>' + replaceZero(array[i]["Cost4"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost5"]) + '</td><td>' + replaceZero(array[i]["Cost6"]) + '</td><td>' + replaceZero(array[i]["Cost7"]) + '</td><td>' + replaceZero(array[i]["Cost8"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost9"]) + '</td><td>' + replaceZero(array[i]["Cost10"]) + '</td><td>' + replaceZero(array[i]["Cost11"]) + '</td><td>' + replaceZero(array[i]["Cost12"]) + '</td><td>' +
                                    replaceZero(array[i]["CostHaihu"]) + '</td><td>' + commaSeparate(array[i]["CostHimoku"]) + '</td><td>' + commaSeparate(array[i]["CostShikakari"]) + '</td>';
                            }
                            a_row = 1;
                            $('#tblExcel tbody').append($('<tr>'));
                            $('#tblExcel tbody tr:last').append(add_row);
                        }
                        else if (array[i]["SortKey"] == '11') {
                            add_row = '<td></td><td style="border-top: 1px solid; border-bottom: 1px solid">' + array[i]["CostName"] + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["CostShikakari"]) + '</td>';
                            $('#tblExcel tbody').append($('<tr>'));
                            $('#tblExcel tbody tr:last').append(add_row);
                        }

                        else if (array[i]["SortKey"] == '20') {
                            var prj_count = 0;
                            var pmodel = {
                                BrandCD: array[i]["BrandCD"],
                                Season: array[i]["Season"],
                                LoginID: '@LoginID',
                                Type: 'B'
                            };
                            var B_data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                            var B_array = typeof JSONString != 'object' ? JSON.parse(B_data) : JSONString;

                            for (b = 0; b < B_array.length; b++) {
                                if (B_array[b]["SortKey"] == '20') {
                                    if (o_row == 0) {
                                        isrowspan = 1;
                                        add_row = '<td rowspan = ' + B_array[b]["Row_Count"] + ' style="text-align: center;background-color: #8FAADC; vertical-align: middle;">' + B_array[b]["BrandName"] + '</td><td style="background-color: #8FAADC"></td><td>' + B_array[b]["CostName"] + '</td><td>' +
                                            replaceZero(B_array[b]["CostPre"]) + '</td><td>' + replaceZero(B_array[b]["Cost1"]) + '</td><td>' + replaceZero(B_array[b]["Cost2"]) + '</td><td>' + replaceZero(B_array[b]["Cost3"]) + '</td><td>' +
                                            replaceZero(B_array[b]["Cost4"]) + '</td><td>' + replaceZero(B_array[b]["Cost5"]) + '</td><td>' + replaceZero(B_array[b]["Cost6"]) + '</td><td>' + replaceZero(B_array[b]["Cost7"]) + '</td><td>' +
                                            replaceZero(B_array[b]["Cost8"]) + '</td><td>' + replaceZero(B_array[b]["Cost9"]) + '</td><td>' + replaceZero(B_array[b]["Cost10"]) + '</td><td>' + replaceZero(B_array[b]["Cost11"]) + '</td><td>' +
                                            replaceZero(B_array[b]["Cost12"]) + '</td><td>' + replaceZero(B_array[b]["CostHaihu"]) + '</td><td>' + commaSeparate(B_array[b]["CostHimoku"]) + '</td><td>' + commaSeparate(B_array[b]["CostShikakari"]) + '</td>';
                                    }
                                    else {
                                        add_row = '<td style="background-color: #8FAADC"></td><td>' + B_array[b]["CostName"] + '</td><td>' + replaceZero(B_array[b]["CostPre"]) + '</td><td>' + replaceZero(B_array[b]["Cost1"]) + '</td><td>' + replaceZero(B_array[b]["Cost2"]) + '</td><td>' +
                                            replaceZero(B_array[b]["Cost3"]) + '</td><td>' + replaceZero(B_array[b]["Cost4"]) + '</td><td>' + replaceZero(B_array[b]["Cost5"]) + '</td><td>' + replaceZero(B_array[b]["Cost6"]) + '</td><td>' +
                                            replaceZero(B_array[b]["Cost7"]) + '</td><td>' + replaceZero(B_array[b]["Cost8"]) + '</td><td>' + replaceZero(B_array[b]["Cost9"]) + '</td><td>' + replaceZero(B_array[b]["Cost10"]) + '</td><td>' +
                                            replaceZero(B_array[b]["Cost11"]) + '</td><td>' + replaceZero(B_array[b]["Cost12"]) + '</td><td>' + replaceZero(B_array[b]["CostHaihu"]) + '</td><td>' + commaSeparate(B_array[b]["CostHimoku"]) + '</td><td>' + commaSeparate(B_array[b]["CostShikakari"]) + '</td>';
                                    }
                                    o_row = 1;
                                    $('#tblExcel tbody').append($('<tr>'));
                                    $('#tblExcel tbody tr:last').append(add_row);
                                }
                                else if (B_array[b]["SortKey"] == '21') {
                                    add_row = '<td style="background-color: #8FAADC"></td><td style="border-top: 1px solid; border-bottom: 1px solid">' + B_array[b]["CostName"] + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                        commaSeparate(B_array[b]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                        commaSeparate(B_array[b]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                        commaSeparate(B_array[b]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                        commaSeparate(B_array[b]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(B_array[b]["CostShikakari"]) + '</td>';
                                    $('#tblExcel tbody').append($('<tr>'));
                                    $('#tblExcel tbody tr:last').append(add_row);
                                    o_row = 0;
                                }
                                else if (B_array[b]["SortKey"] == '30') {
                                    var rowcountC = 1, colC2, j, newrowspan, rowspancount = 0;
                                    var pmodel = {
                                        BrandCD: B_array[b]["BrandCD"],
                                        Season: B_array[b]["Season"],
                                        ProjectCD: B_array[b]["ProjectCD"],
                                        LoginID: '@LoginID',
                                        Type: 'C'
                                    };
                                    rowspancount = B_array[b]["Row_Count"];
                                    var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                    var prj_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;

                                    for (j = 0; j < prj_array.length; j++) {
                                        if (prj_array[j]["SortKey"] == '30' || prj_array[j]["SortKey"] == '31' || prj_array[j]["SortKey"] == '32') {
                                            switch (rowcountC) {
                                                case 1: colC2 = prj_array[0]["ProjectCD"] + '    ' + prj_array[0]["ProjectName"];
                                                    break;
                                                case 2: colC2 = prj_array[0]["PeriodStart"] + ' ～ ' + prj_array[0]["PeriodEnd"];
                                                    break;
                                                case 3: colC2 = '総金額      ' + commaSeparate(prj_array[0]["ProductionSum"]);
                                                    break;
                                                case 4: colC2 = '総生産数    ' + commaSeparate(prj_array[0]["TotalValueSum"]);
                                                    break;
                                                default: colC2 = '';
                                                    break;
                                            }

                                            if (prj_array[j]["SortKey"] == '30') {
                                                if (isrowspan == 0) {
                                                    newrowspan = '<td rowspan = ' + rowspancount + ' style="text-align: center;background-color: #8FAADC; vertical-align: middle;"></td>';
                                                    isrowspan = 1;
                                                }

                                                add_row = newrowspan + '<td>' + colC2 + '</td><td>' + prj_array[j]["CostName"] + '</td><td>' + replaceZero(prj_array[j]["CostPre"]) + '</td><td>' +
                                                    replaceZero(prj_array[j]["Cost1"]) + '</td><td>' + replaceZero(prj_array[j]["Cost2"]) + '</td><td>' + replaceZero(prj_array[j]["Cost3"]) + '</td><td>' + replaceZero(prj_array[j]["Cost4"]) + '</td><td>' +
                                                    replaceZero(prj_array[j]["Cost5"]) + '</td><td>' + replaceZero(prj_array[j]["Cost6"]) + '</td><td>' + replaceZero(prj_array[j]["Cost7"]) + '</td><td>' + replaceZero(prj_array[j]["Cost8"]) + '</td><td>' +
                                                    replaceZero(prj_array[j]["Cost9"]) + '</td><td>' + replaceZero(prj_array[j]["Cost10"]) + '</td><td>' + replaceZero(prj_array[j]["Cost11"]) + '</td><td>' + replaceZero(prj_array[j]["Cost12"]) + '</td><td>' +
                                                    replaceZero(prj_array[j]["CostHaihu"]) + '</td><td>' + commaSeparate(prj_array[j]["CostHimoku"]) + '</td><td>' + commaSeparate(prj_array[j]["CostShikakari"]) + '</td>';

                                                newrowspan = '';
                                            }
                                            else if (prj_array[j]["SortKey"] == '31') {
                                                add_row = '<td>' + colC2 + '</td>';
                                            }
                                            else if (prj_array[j]["SortKey"] == '32') {
                                                add_row = '<td style="border-bottom: 1px solid">' + colC2 + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + prj_array[j]["CostName"] + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prj_array[j]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prj_array[j]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prj_array[j]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prj_array[j]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostShikakari"]) + '</td>';
                                            }
                                            rowcountC = rowcountC + 1;
                                            $('#tblExcel tbody').append($('<tr>'));
                                            $('#tblExcel tbody tr:last').append(add_row);
                                        }
                                        else {
                                            if (prj_array[j]["SortKey"] == '40') {
                                                prj_count = 1;
                                                var rowcountD = 1, colD2, k, style;
                                                var pmodel = {
                                                    BrandCD: prj_array[j]["BrandCD"],
                                                    Season: prj_array[j]["Season"],
                                                    ProjectCD: prj_array[j]["ProjectCD"],
                                                    HinbanCD: prj_array[j]["HinbanCD"],
                                                    LoginID: '@LoginID',
                                                    Type: 'D'
                                                };
                                                var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                                var prjD_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                                for (k = 0; k < prjD_array.length; k++) {
                                                    switch (rowcountD) {
                                                        case 1: colD2 = prjD_array[0]["HinbanCD"] + '   ' + prjD_array[0]["HinbanName"];
                                                            break;
                                                        case 2: colD2 = '色数     ' + prjD_array[0]["Color"] + '色';
                                                            break;
                                                        case 3: colD2 = '生産数    ' + commaSeparate(prjD_array[0]["Production"]);
                                                            break;
                                                        case 4: colD2 = '累計納品数  ' + commaSeparate(prjD_array[0]["Complete"]);
                                                            break;
                                                        case 5: colD2 = '予定販売定価 ' + commaSeparate(prjD_array[0]["SalesPrice"]);
                                                            break;
                                                        case 6: colD2 = '総金額    ' + commaSeparate(prjD_array[0]["TotalValue"]); //2021-03-31 by syk
                                                            break;
                                                        case 7: colD2 = '金型名     ' + prjD_array[0]["CastingName"];
                                                            break;
                                                        case 8: colD2 = '見込利益   ' + commaSeparate(prjD_array[0]["Profit"]);
                                                            break;
                                                        case 9: colD2 = '見込利益率  ' + prjD_array[0]["ProfitPercentage"] + '%';
                                                            break;
                                                        default: colD2 = '';
                                                            break;
                                                    }

                                                    if (k == prjD_array.length - 1 && j < prj_array.length - 1)
                                                        style = 'style = "border-bottom: 1px solid;"';
                                                    else
                                                        style = '';

                                                    if (prjD_array[k]["SortKey"] !== 42 && prjD_array[k]["SortKey"] !== 43) {
                                                        add_row = '<td>' + colD2 + '</td><td>' + replaceNull(prjD_array[k]["CostName"]) + '</td><td>' + replaceZero(prjD_array[k]["CostPre"]) + '</td><td>' +
                                                            replaceZero(prjD_array[k]["Cost1"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost2"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost3"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost4"]) + '</td><td>' +
                                                            replaceZero(prjD_array[k]["Cost5"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost6"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost7"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost8"]) + '</td><td>' +
                                                            replaceZero(prjD_array[k]["Cost9"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost10"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost11"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost12"]) + '</td><td>' +
                                                            replaceZero(prjD_array[k]["CostHaihu"]) + '</td><td>' + commaSeparate(prjD_array[k]["CostHimoku"]) + '</td><td>' + commaSeparate(prjD_array[k]["CostShikakari"]) + '</td>';
                                                    }
                                                    else if (prjD_array[k]["SortKey"] == '42') {
                                                        add_row = '<td>' + colD2 + '</td>';
                                                    }
                                                    else if (prjD_array[k]["SortKey"] == '43') {
                                                        add_row = '<td ' + style + '>' + colD2 + '</td><td style="border-bottom: 1px solid">' + replaceNull(prjD_array[k]["CostName"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                            commaSeparate(prjD_array[k]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                            commaSeparate(prjD_array[k]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                            commaSeparate(prjD_array[k]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                            commaSeparate(prjD_array[k]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostShikakari"]) + '</td>';
                                                    }
                                                    rowcountD = rowcountD + 1;
                                                    $('#tblExcel tbody').append($('<tr>'));
                                                    $('#tblExcel tbody tr:last').append(add_row);
                                                }
                                            }
                                            else {
                                            }
                                        }
                                    }

                                    if (prj_count == 1) {
                                        var l;
                                        var pmodel = {
                                            BrandCD: prj_array[0]["BrandCD"],
                                            Season: prj_array[0]["Season"],
                                            ProjectCD: prj_array[0]["ProjectCD"],
                                            HinbanCD: prj_array[0]["HinbanCD"],
                                            LoginID: '@LoginID',
                                            Type: 'P_Total'
                                        };
                                        var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                        var prjPTotal_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                        for (l = 0; l < prjPTotal_array.length; l++) {
                                            add_row = '<td style="border-bottom: 1px solid;"></td><td style="border-bottom: 1px solid">' + prjPTotal_array[l]["CostName"] + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["CostPre"]) + '</td><td style="border-bottom: 1px solid">' +
                                                commaSeparate(prjPTotal_array[l]["Cost1"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost2"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost3"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost4"]) + '</td><td style="border-bottom: 1px solid">' +
                                                commaSeparate(prjPTotal_array[l]["Cost5"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost6"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost7"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost8"]) + '</td><td style="border-bottom: 1px solid">' +
                                                commaSeparate(prjPTotal_array[l]["Cost9"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost10"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost11"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost12"]) + '</td><td style="border-bottom: 1px solid">' +
                                                commaSeparate(prjPTotal_array[l]["CostHaihu"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Total"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["CostShikakari"]) + '</td>';
                                            $('#tblExcel tbody').append($('<tr>'));
                                            $('#tblExcel tbody tr:last').append(add_row);
                                        }
                                    }
                                }
                            }

                            if (prj_count == 1) {
                                var m;
                                var pmodel = {
                                    LoginID: '@LoginID',
                                    Type: 'D_Total'
                                };
                                var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                var prjDTotal_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                for (m = 0; m < prjDTotal_array.length; m++) {
                                    add_row = '<td style="border-bottom: 1px solid; background-color: #8FAADC;"></td><td style="border-bottom: 1px solid">' + prjDTotal_array[m]["CostName"] + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["CostPre"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["Cost1"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost2"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost3"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost4"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["Cost5"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost6"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost7"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost8"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["Cost9"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost10"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost11"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost12"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["CostHaihu"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Total"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["CostShikakari"]) + '</td>';
                                    $('#tblExcel tbody').append($('<tr>'));
                                    $('#tblExcel tbody tr:last').append(add_row);
                                }
                            }
                        }

                        else if (array[i]["SortKey"] == '30') {
                            var prj_count = 0;
                            var pmodel = {
                                BrandCD: array[i]["BrandCD"],
                                Season: array[i]["Season"],
                                LoginID: '@LoginID',
                                Type: 'B'
                            };
                            var B30_data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                            var B30_array = typeof JSONString != 'object' ? JSON.parse(B30_data) : JSONString;

                            for (b = 0; b < B30_array.length; b++) {
                                var rowcountC = 1, colC2, j, newrowspan, rowspancount = 0, isrowspan = 0;
                                var pmodel = {
                                    BrandCD: B30_array[b]["BrandCD"],
                                    Season: B30_array[b]["Season"],
                                    ProjectCD: B30_array[b]["ProjectCD"],
                                    LoginID: '@LoginID',
                                    Type: 'C'
                                };
                                rowspancount = B30_array[b]["Row_Count"];
                                var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                var prj_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;

                                for (j = 0; j < prj_array.length; j++) {
                                    if (prj_array[j]["SortKey"] == '30' || prj_array[j]["SortKey"] == '31' || prj_array[j]["SortKey"] == '32') {
                                        switch (rowcountC) {
                                            case 1: colC2 = prj_array[0]["ProjectCD"] + '    ' + prj_array[0]["ProjectName"];
                                                break;
                                            case 2: colC2 = prj_array[0]["PeriodStart"] + ' ～ ' + prj_array[0]["PeriodEnd"];
                                                break;
                                            case 3: colC2 = '総金額      ' + commaSeparate(prj_array[0]["ProductionSum"]);
                                                break;
                                            case 4: colC2 = '総生産数    ' + commaSeparate(prj_array[0]["TotalValueSum"]);
                                                break;
                                            default: colC2 = '';
                                                break;
                                        }

                                        if (prj_array[j]["SortKey"] == '30') {
                                            if (isrowspan == 0) {
                                                newrowspan = '<td rowspan = ' + rowspancount + ' style="text-align: center; background-color: #8FAADC; vertical-align: middle;">' + prj_array[0]["BrandName"] + '</td>';
                                                isrowspan = 1;
                                            }

                                            add_row = newrowspan + '<td>' + colC2 + '</td><td>' + prj_array[j]["CostName"] + '</td><td>' + replaceZero(prj_array[j]["CostPre"]) + '</td><td>' +
                                                replaceZero(prj_array[j]["Cost1"]) + '</td><td>' + replaceZero(prj_array[j]["Cost2"]) + '</td><td>' + replaceZero(prj_array[j]["Cost3"]) + '</td><td>' + replaceZero(prj_array[j]["Cost4"]) + '</td><td>' +
                                                replaceZero(prj_array[j]["Cost5"]) + '</td><td>' + replaceZero(prj_array[j]["Cost6"]) + '</td><td>' + replaceZero(prj_array[j]["Cost7"]) + '</td><td>' + replaceZero(prj_array[j]["Cost8"]) + '</td><td>' +
                                                replaceZero(prj_array[j]["Cost9"]) + '</td><td>' + replaceZero(prj_array[j]["Cost10"]) + '</td><td>' + replaceZero(prj_array[j]["Cost11"]) + '</td><td>' + replaceZero(prj_array[j]["Cost12"]) + '</td><td>' +
                                                replaceZero(prj_array[j]["CostHaihu"]) + '</td><td>' + commaSeparate(prj_array[j]["CostHimoku"]) + '</td><td>' + commaSeparate(prj_array[j]["CostShikakari"]) + '</td>';

                                            newrowspan = '';
                                        }
                                        else if (prj_array[j]["SortKey"] == '31') {
                                            add_row = '<td>' + colC2 + '</td>';
                                        }
                                        else if (prj_array[j]["SortKey"] == '32') {
                                            add_row = '<td style="border-bottom: 1px solid">' + colC2 + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + prj_array[j]["CostName"] + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(prj_array[j]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(prj_array[j]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(prj_array[j]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(prj_array[j]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostShikakari"]) + '</td>';
                                        }
                                        rowcountC = rowcountC + 1;
                                        $('#tblExcel tbody').append($('<tr>'));
                                        $('#tblExcel tbody tr:last').append(add_row);
                                    }

                                    else {
                                        if (prj_array[j]["SortKey"] == '40') {
                                            prj_count = 1;
                                            var rowcountD = 1, colD2, k, style;
                                            var pmodel = {
                                                BrandCD: prj_array[j]["BrandCD"],
                                                Season: prj_array[j]["Season"],
                                                ProjectCD: prj_array[j]["ProjectCD"],
                                                HinbanCD: prj_array[j]["HinbanCD"],
                                                LoginID: '@LoginID',
                                                Type: 'D'
                                            };
                                            var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                            var prjD_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                            for (k = 0; k < prjD_array.length; k++) {
                                                switch (rowcountD) {
                                                    case 1: colD2 = prjD_array[0]["HinbanCD"] + '   ' + prjD_array[0]["HinbanName"];
                                                        break;
                                                    case 2: colD2 = '色数     ' + prjD_array[0]["Color"] + '色';
                                                        break;
                                                    case 3: colD2 = '生産数    ' + commaSeparate(prjD_array[0]["Production"]);
                                                        break;
                                                    case 4: colD2 = '累計納品数  ' + commaSeparate(prjD_array[0]["Complete"]);
                                                        break;
                                                    case 5: colD2 = '予定販売定価 ' + commaSeparate(prjD_array[0]["SalesPrice"]);
                                                        break;
                                                    case 6: colD2 = '総金額    ' + commaSeparate(prjD_array[0]["TotalValue"]); //2021-03-31 by syk
                                                        break;
                                                    case 7: colD2 = '金型名     ' + prjD_array[0]["CastingName"];
                                                        break;
                                                    case 8: colD2 = '見込利益   ' + commaSeparate(prjD_array[0]["Profit"]);
                                                        break;
                                                    case 9: colD2 = '見込利益率  ' + prjD_array[0]["ProfitPercentage"] + '%';
                                                        break;
                                                    default: colD2 = '';
                                                        break;
                                                }

                                                if (k == prjD_array.length - 1 && j < prj_array.length - 1)
                                                    style = 'style = "border-bottom: 1px solid;"';
                                                else
                                                    style = '';

                                                if (prjD_array[k]["SortKey"] !== 42 && prjD_array[k]["SortKey"] !== 43) {
                                                    add_row = '<td>' + colD2 + '</td><td>' + replaceNull(prjD_array[k]["CostName"]) + '</td><td>' + replaceZero(prjD_array[k]["CostPre"]) + '</td><td>' +
                                                        replaceZero(prjD_array[k]["Cost1"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost2"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost3"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost4"]) + '</td><td>' +
                                                        replaceZero(prjD_array[k]["Cost5"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost6"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost7"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost8"]) + '</td><td>' +
                                                        replaceZero(prjD_array[k]["Cost9"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost10"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost11"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost12"]) + '</td><td>' +
                                                        replaceZero(prjD_array[k]["CostHaihu"]) + '</td><td>' + commaSeparate(prjD_array[k]["CostHimoku"]) + '</td><td>' + commaSeparate(prjD_array[k]["CostShikakari"]) + '</td>';
                                                }
                                                else if (prjD_array[k]["SortKey"] == '42') {
                                                    add_row = '<td>' + colD2 + '</td>';
                                                }
                                                else if (prjD_array[k]["SortKey"] == '43') {
                                                    add_row = '<td ' + style + '>' + colD2 + '</td><td style="border-bottom: 1px solid">' + replaceNull(prjD_array[k]["CostName"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                        commaSeparate(prjD_array[k]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                        commaSeparate(prjD_array[k]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                        commaSeparate(prjD_array[k]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                        commaSeparate(prjD_array[k]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostShikakari"]) + '</td>';
                                                }
                                                rowcountD = rowcountD + 1;
                                                $('#tblExcel tbody').append($('<tr>'));
                                                $('#tblExcel tbody tr:last').append(add_row);
                                            }
                                        }
                                    }
                                }

                                if (prj_count == 1) {
                                    var l;
                                    var pmodel = {
                                        BrandCD: prj_array[0]["BrandCD"],
                                        Season: prj_array[0]["Season"],
                                        ProjectCD: prj_array[0]["ProjectCD"],
                                        HinbanCD: prj_array[0]["HinbanCD"],
                                        LoginID: '@LoginID',
                                        Type: 'P_Total'
                                    };
                                    var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                    var prjPTotal_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                    for (l = 0; l < prjPTotal_array.length; l++) {
                                        add_row = '<td style="border-bottom: 1px solid"></td><td style="border-bottom: 1px solid">' + prjPTotal_array[l]["CostName"] + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["CostPre"]) + '</td><td style="border-bottom: 1px solid">' +
                                            commaSeparate(prjPTotal_array[l]["Cost1"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost2"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost3"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost4"]) + '</td><td style="border-bottom: 1px solid">' +
                                            commaSeparate(prjPTotal_array[l]["Cost5"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost6"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost7"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost8"]) + '</td><td style="border-bottom: 1px solid">' +
                                            commaSeparate(prjPTotal_array[l]["Cost9"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost10"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost11"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost12"]) + '</td><td style="border-bottom: 1px solid">' +
                                            commaSeparate(prjPTotal_array[l]["CostHaihu"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Total"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["CostShikakari"]) + '</td>';
                                        $('#tblExcel tbody').append($('<tr>'));
                                        $('#tblExcel tbody tr:last').append(add_row);
                                    }
                                }
                            }

                            if (prj_count == 1) {
                                var m;
                                var pmodel = {
                                    LoginID: '@LoginID',
                                    Type: 'D_Total'
                                };
                                var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                var prjDTotal_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                for (m = 0; m < prjDTotal_array.length; m++) {
                                    add_row = '<td style="border-bottom: 1px solid; background-color: #8FAADC;"></td><td style="border-bottom: 1px solid">' + prjDTotal_array[m]["CostName"] + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["CostPre"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["Cost1"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost2"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost3"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost4"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["Cost5"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost6"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost7"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost8"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["Cost9"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost10"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost11"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost12"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjDTotal_array[m]["CostHaihu"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Total"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["CostShikakari"]) + '</td>';
                                    $('#tblExcel tbody').append($('<tr>'));
                                    $('#tblExcel tbody tr:last').append(add_row);
                                }
                            }
                        }


                        //CLOSED BY TZA 04/06/2021
                        @*else if (array[i]["SortKey"] == '20') {
                            if (o_row == 0) {
                                isrowspan = 1;
                                add_row = '<td rowspan = ' + array[i]["Row_Count"] + ' style="text-align: center;background-color: #8FAADC; vertical-align: middle;">' + array[i]["BrandName"] + '</td><td style="background-color: #8FAADC"></td><td>' + array[i]["CostName"] + '</td><td>' +
                                    replaceZero(array[i]["CostPre"]) + '</td><td>' + replaceZero(array[i]["Cost1"]) + '</td><td>' + replaceZero(array[i]["Cost2"]) + '</td><td>' + replaceZero(array[i]["Cost3"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost4"]) + '</td><td>' + replaceZero(array[i]["Cost5"]) + '</td><td>' + replaceZero(array[i]["Cost6"]) + '</td><td>' + replaceZero(array[i]["Cost7"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost8"]) + '</td><td>' + replaceZero(array[i]["Cost9"]) + '</td><td>' + replaceZero(array[i]["Cost10"]) + '</td><td>' + replaceZero(array[i]["Cost11"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost12"]) + '</td><td>' + replaceZero(array[i]["CostHaihu"]) + '</td><td>' + commaSeparate(array[i]["CostHimoku"]) + '</td><td>' + commaSeparate(array[i]["CostShikakari"]) + '</td>';
                            }
                            else {
                                add_row = '<td style="background-color: #8FAADC"></td><td>' + array[i]["CostName"] + '</td><td>' + replaceZero(array[i]["CostPre"]) + '</td><td>' + replaceZero(array[i]["Cost1"]) + '</td><td>' + replaceZero(array[i]["Cost2"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost3"]) + '</td><td>' + replaceZero(array[i]["Cost4"]) + '</td><td>' + replaceZero(array[i]["Cost5"]) + '</td><td>' + replaceZero(array[i]["Cost6"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost7"]) + '</td><td>' + replaceZero(array[i]["Cost8"]) + '</td><td>' + replaceZero(array[i]["Cost9"]) + '</td><td>' + replaceZero(array[i]["Cost10"]) + '</td><td>' +
                                    replaceZero(array[i]["Cost11"]) + '</td><td>' + replaceZero(array[i]["Cost12"]) + '</td><td>' + replaceZero(array[i]["CostHaihu"]) + '</td><td>' + commaSeparate(array[i]["CostHimoku"]) + '</td><td>' + commaSeparate(array[i]["CostShikakari"]) + '</td>';
                            }
                            o_row = 1;
                            $('#tblExcel tbody').append($('<tr>'));
                            $('#tblExcel tbody tr:last').append(add_row);
                        }
                        else if (array[i]["SortKey"] == '21') {
                            add_row = '<td style="background-color: #8FAADC"></td><td style="border-top: 1px solid; border-bottom: 1px solid">' + array[i]["CostName"] + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                commaSeparate(array[i]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(array[i]["CostShikakari"]) + '</td>';
                            $('#tblExcel tbody').append($('<tr>'));
                            $('#tblExcel tbody tr:last').append(add_row);
                        }
                        else if (array[i]["SortKey"] == '30') {
                            var rowcountC = 1, colC2, j, newrowspan, rowspancount = 0;
                            var pmodel = {
                                ProjectCD: array[i]["ProjectCD"],
                                LoginID: '@LoginID',
                                Type: 'C'
                            };
                            rowspancount = array[i]["Row_Count"];
                            var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                            var prj_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;

                            for (j = 0; j < prj_array.length; j++) {
                                if (prj_array[j]["SortKey"] == '30' || prj_array[j]["SortKey"] == '31' || prj_array[j]["SortKey"] == '32') {
                                    switch (rowcountC) {
                                        case 1: colC2 = prj_array[0]["ProjectCD"] + '    ' + prj_array[0]["ProjectName"];
                                            break;
                                        case 2: colC2 = prj_array[0]["PeriodStart"] + ' ～ ' + prj_array[0]["PeriodEnd"];
                                            break;
                                        case 3: colC2 = '総金額      ' + commaSeparate(prj_array[0]["ProductionSum"]);
                                            break;
                                        case 4: colC2 = '総生産数    ' + commaSeparate(prj_array[0]["TotalValueSum"]);
                                            break;
                                        default: colC2 = '';
                                            break;
                                    }

                                    if (prj_array[j]["SortKey"] == '30') {
                                        if (isrowspan == 0) {
                                            newrowspan = '<td rowspan = ' + rowspancount + ' style="text-align: center;background-color: #8FAADC; vertical-align: middle;"></td>';
                                            isrowspan = 1;
                                        }

                                        add_row = newrowspan + '<td>' + colC2 + '</td><td>' + prj_array[j]["CostName"] + '</td><td>' + replaceZero(prj_array[j]["CostPre"]) + '</td><td>' +
                                            replaceZero(prj_array[j]["Cost1"]) + '</td><td>' + replaceZero(prj_array[j]["Cost2"]) + '</td><td>' + replaceZero(prj_array[j]["Cost3"]) + '</td><td>' + replaceZero(prj_array[j]["Cost4"]) + '</td><td>' +
                                            replaceZero(prj_array[j]["Cost5"]) + '</td><td>' + replaceZero(prj_array[j]["Cost6"]) + '</td><td>' + replaceZero(prj_array[j]["Cost7"]) + '</td><td>' + replaceZero(prj_array[j]["Cost8"]) + '</td><td>' +
                                            replaceZero(prj_array[j]["Cost9"]) + '</td><td>' + replaceZero(prj_array[j]["Cost10"]) + '</td><td>' + replaceZero(prj_array[j]["Cost11"]) + '</td><td>' + replaceZero(prj_array[j]["Cost12"]) + '</td><td>' +
                                            replaceZero(prj_array[j]["CostHaihu"]) + '</td><td>' + commaSeparate(prj_array[j]["CostHimoku"]) + '</td><td>' + commaSeparate(prj_array[j]["CostShikakari"]) + '</td>';

                                        newrowspan = '';

                                    }
                                    else if (prj_array[j]["SortKey"] == '31') {
                                        add_row = '<td>' + colC2 + '</td>';
                                    }
                                    else if (prj_array[j]["SortKey"] == '32') {
                                        add_row = '<td style="border-bottom: 1px solid">' + colC2 + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + prj_array[j]["CostName"] + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                            commaSeparate(prj_array[j]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                            commaSeparate(prj_array[j]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                            commaSeparate(prj_array[j]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                            commaSeparate(prj_array[j]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prj_array[j]["CostShikakari"]) + '</td>';
                                    }
                                    rowcountC = rowcountC + 1;
                                    $('#tblExcel tbody').append($('<tr>'));
                                    $('#tblExcel tbody tr:last').append(add_row);
                                }
                                else {
                                    if (prj_array[j]["SortKey"] == '40') {
                                        prj_count = 1;
                                        var rowcountD = 1, colD2, k, style;
                                        var pmodel = {
                                            ProjectCD: prj_array[j]["ProjectCD"],
                                            HinbanCD: prj_array[j]["HinbanCD"],
                                            LoginID: '@LoginID',
                                            Type: 'D'
                                        };
                                        var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                        var prjD_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                        for (k = 0; k < prjD_array.length; k++) {
                                            switch (rowcountD) {
                                                case 1: colD2 = prjD_array[0]["HinbanCD"] + '   ' + prjD_array[0]["HinbanName"];
                                                    break;
                                                case 2: colD2 = '色数     ' + prjD_array[0]["Color"] + '色';
                                                    break;
                                                case 3: colD2 = '生産数    ' + commaSeparate(prjD_array[0]["Production"]);
                                                    break;
                                                case 4: colD2 = '累計納品数  ' + commaSeparate(prjD_array[0]["Complete"]);
                                                    break;
                                                case 5: colD2 = '予定販売定価 ' + commaSeparate(prjD_array[0]["SalesPrice"]);
                                                    break;
                                                case 6: colD2 = '総金額    ' + commaSeparate(prjD_array[0]["TotalValue"]); //2021-03-31 by syk
                                                    break;
                                                case 7: colD2 = '金型名     ' + prjD_array[0]["CastingName"];
                                                    break;
                                                case 8: colD2 = '見込利益   ' + commaSeparate(prjD_array[0]["Profit"]);
                                                    break;
                                                case 9: colD2 = '見込利益率  ' + prjD_array[0]["ProfitPercentage"] + '%';
                                                    break;
                                                default: colD2 = '';
                                                    break;
                                            }

                                            if (k == prjD_array.length - 1 && j < prj_array.length - 1)
                                                style = 'style = "border-bottom: 1px solid;"';
                                            else
                                                style = '';

                                            if (prjD_array[k]["SortKey"] !== 42 && prjD_array[k]["SortKey"] !== 43) {
                                                add_row = '<td>' + colD2 + '</td><td>' + replaceNull(prjD_array[k]["CostName"]) + '</td><td>' + replaceZero(prjD_array[k]["CostPre"]) + '</td><td>' +
                                                    replaceZero(prjD_array[k]["Cost1"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost2"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost3"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost4"]) + '</td><td>' +
                                                    replaceZero(prjD_array[k]["Cost5"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost6"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost7"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost8"]) + '</td><td>' +
                                                    replaceZero(prjD_array[k]["Cost9"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost10"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost11"]) + '</td><td>' + replaceZero(prjD_array[k]["Cost12"]) + '</td><td>' +
                                                    replaceZero(prjD_array[k]["CostHaihu"]) + '</td><td>' + commaSeparate(prjD_array[k]["CostHimoku"]) + '</td><td>' + commaSeparate(prjD_array[k]["CostShikakari"]) + '</td>';
                                            }
                                            else if (prjD_array[k]["SortKey"] == '42') {
                                                add_row = '<td>' + colD2 + '</td>';
                                            }
                                            else if (prjD_array[k]["SortKey"] == '43') {

                                                add_row = '<td ' + style + '>' + colD2 + '</td><td style="border-bottom: 1px solid">' + replaceNull(prjD_array[k]["CostName"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prjD_array[k]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prjD_array[k]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prjD_array[k]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                    commaSeparate(prjD_array[k]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(prjD_array[k]["CostShikakari"]) + '</td>';

                                            }
                                            rowcountD = rowcountD + 1;
                                            $('#tblExcel tbody').append($('<tr>'));
                                            $('#tblExcel tbody tr:last').append(add_row);
                                        }
                                    }
                                    else {
                                    }
                                }
                            }

                            if (prj_count == 1) {
                                var l;
                                var pmodel = {
                                    ProjectCD: prj_array[0]["ProjectCD"],
                                    HinbanCD: prj_array[0]["HinbanCD"],
                                    LoginID: '@LoginID',
                                    Type: 'P_Total'
                                };
                                var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                var prjPTotal_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                                for (l = 0; l < prjPTotal_array.length; l++) {
                                    add_row = '<td style="border-bottom: 1px solid"></td><td style="border-bottom: 1px solid">' + prjPTotal_array[l]["CostName"] + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["CostPre"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjPTotal_array[l]["Cost1"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost2"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost3"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost4"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjPTotal_array[l]["Cost5"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost6"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost7"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost8"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjPTotal_array[l]["Cost9"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost10"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost11"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Cost12"]) + '</td><td style="border-bottom: 1px solid">' +
                                        commaSeparate(prjPTotal_array[l]["CostHaihu"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["Total"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjPTotal_array[l]["CostShikakari"]) + '</td>';
                                    $('#tblExcel tbody').append($('<tr>'));
                                    $('#tblExcel tbody tr:last').append(add_row);
                                }
                            }
                        }*@

                        //START UNSED CODE
                        @*else if (array[i]["SortKey"] == '40') {
                            var pmodel = {
                                ProjectCD: '',
                                LoginID: '@LoginID',
                                Type: 'CLite'
                            };
                            rowspancount = array[i]["Row_Count"];
                            var hinban_data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                            var hinban_array = typeof JSONString != 'object' ? JSON.parse(hinban_data) : JSONString;

                            for (j = 0; j < hinban_array.length; j++) {
                                if (hinban_array[j]["SortKey"] == '40') {
                                    prj_count = 1;
                                    var rowcountD = 1, colD2, k, style;
                                    var pmodel = {
                                        ProjectCD: hinban_array[j]["ProjectCD"],
                                        HinbanCD: hinban_array[j]["HinbanCD"],
                                        LoginID: '@LoginID',
                                        Type: 'D'
                                    };
                                    var hdata = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                                    var hinbanD_array = typeof JSONString != 'object' ? JSON.parse(hdata) : JSONString;
                                    for (k = 0; k < hinbanD_array.length; k++) {
                                        switch (rowcountD) {
                                            case 1: colD2 = hinbanD_array[0]["HinbanCD"] + '   ' + hinbanD_array[0]["HinbanName"];
                                                break;
                                            case 2: colD2 = '色数     ' + hinbanD_array[0]["Color"] + '色';
                                                break;
                                            case 3: colD2 = '生産数    ' + commaSeparate(hinbanD_array[0]["Production"]);
                                                break;
                                            case 4: colD2 = '累計納品数  ' + commaSeparate(hinbanD_array[0]["Complete"]);
                                                break;
                                            case 5: colD2 = '予定販売定価 ' + commaSeparate(hinbanD_array[0]["SalesPrice"]);
                                                break;
                                            case 6: colD2 = '総金額    ' + commaSeparate(hinbanD_array[0]["TotalValue"]); //2021-03-31 by syk
                                                break;
                                            case 7: colD2 = '金型名     ' + hinbanD_array[0]["CastingName"];
                                                break;
                                            case 8: colD2 = '見込利益   ' + commaSeparate(hinbanD_array[0]["Profit"]);
                                                break;
                                            case 9: colD2 = '見込利益率  ' + hinbanD_array[0]["ProfitPercentage"] + '%';
                                                break;
                                            default: colD2 = '';
                                                break;
                                        }

                                        if (k == hinbanD_array.length - 1 && j < hinbanD_array.length - 1)
                                            style = 'style = "border-bottom: 1px solid;"';
                                        else
                                            style = '';

                                        if (hinbanD_array[k]["SortKey"] !== 42 && hinbanD_array[k]["SortKey"] !== 43) {
                                            add_row = '<td>' + colD2 + '</td><td>' + replaceNull(hinbanD_array[k]["CostName"]) + '</td><td>' + replaceZero(hinbanD_array[k]["CostPre"]) + '</td><td>' +
                                                replaceZero(hinbanD_array[k]["Cost1"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost2"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost3"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost4"]) + '</td><td>' +
                                                replaceZero(hinbanD_array[k]["Cost5"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost6"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost7"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost8"]) + '</td><td>' +
                                                replaceZero(hinbanD_array[k]["Cost9"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost10"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost11"]) + '</td><td>' + replaceZero(hinbanD_array[k]["Cost12"]) + '</td><td>' +
                                                replaceZero(hinbanD_array[k]["CostHaihu"]) + '</td><td>' + commaSeparate(hinbanD_array[k]["CostHimoku"]) + '</td><td>' + commaSeparate(hinbanD_array[k]["CostShikakari"]) + '</td>';
                                        }
                                        else if (hinbanD_array[k]["SortKey"] == '42') {
                                            add_row = '<td>' + colD2 + '</td>';
                                        }
                                        else if (hinbanD_array[k]["SortKey"] == '43') {
                                            add_row = '<td ' + style + '>' + colD2 + '</td><td style="border-bottom: 1px solid">' + replaceNull(hinbanD_array[k]["CostName"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["CostPre"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(hinbanD_array[k]["Cost1"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost2"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost3"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost4"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(hinbanD_array[k]["Cost5"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost6"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost7"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost8"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(hinbanD_array[k]["Cost9"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost10"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost11"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["Cost12"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' +
                                                commaSeparate(hinbanD_array[k]["CostHaihu"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["CostHimoku"]) + '</td><td style="border-top: 1px solid; border-bottom: 1px solid">' + commaSeparate(hinbanD_array[k]["CostShikakari"]) + '</td>';
                                        }
                                        rowcountD = rowcountD + 1;
                                        $('#tblExcel tbody').append($('<tr>'));
                                        $('#tblExcel tbody tr:last').append(add_row);
                                    }
                                }
                            }
                        }*@
                        //END UNSED CODE
                        //CLOSED BY TZA 04/06/2021
                    }

                    //CLOSED AND MOVED UP FOR PROJECT TOTAL PLACE BY TZA 10/06/2021
                    @*if (prj_count == 1) {
                        var m;
                        var pmodel = {
                            LoginID: '@LoginID',
                            Type: 'D_Total'
                        };
                        var data = CalltoApiController('@Url.Action("Print_Genka_ProjectData", "api/Print_GenkaApi")', pmodel);
                        var prjDTotal_array = typeof JSONString != 'object' ? JSON.parse(data) : JSONString;
                        for (m = 0; m < prjDTotal_array.length; m++) {
                            add_row = '<td style="border-bottom: 1px solid"></td><td style="border-bottom: 1px solid">' + prjDTotal_array[m]["CostName"] + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["CostPre"]) + '</td><td style="border-bottom: 1px solid">' +
                                commaSeparate(prjDTotal_array[m]["Cost1"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost2"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost3"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost4"]) + '</td><td style="border-bottom: 1px solid">' +
                                commaSeparate(prjDTotal_array[m]["Cost5"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost6"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost7"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost8"]) + '</td><td style="border-bottom: 1px solid">' +
                                commaSeparate(prjDTotal_array[m]["Cost9"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost10"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost11"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Cost12"]) + '</td><td style="border-bottom: 1px solid">' +
                                commaSeparate(prjDTotal_array[m]["CostHaihu"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["Total"]) + '</td><td style="border-bottom: 1px solid">' + commaSeparate(prjDTotal_array[m]["CostShikakari"]) + '</td>';
                            $('#tblExcel tbody').append($('<tr>'));
                            $('#tblExcel tbody tr:last').append(add_row);
                        }
                    }*@
                    //CLOSED AND MOVED UP FOR PROJECT TOTAL PLACE BY TZA 10/06/2021
                }
            }
            else return "E131";
        }

        $('#btnGenerate').keydown(function (e) {
            var code = e.keyCode || e.which;
            if (code == 9) {
                if (e.shiftKey) {
                    //Focus previous input
                    if (thisTab == startIndex) {
                        $("." + tabLimitInID).find('[tabindex=' + lastIndex + ']').focus();
                        return false;
                    }
                    else {
                        e.preventDefault();
                    }
                }
                e.preventDefault();
            }
        });

        //Excel Print//
        var tableToExcel = (function () {
            var uri = 'data:application/vnd.ms-excel;base64,'
                , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
                , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
                , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
            return function (table, name, filename) {
                if (!table.nodeType) table = document.getElementById(table)
                var ctx = {
                    worksheet: name || 'Worksheet',
                    table: table.innerHTML
                }
                document.getElementById("dlink").href = uri + base64(format(template, ctx));
                document.getElementById("dlink").download = filename;
                document.getElementById("dlink").traget = "_blank";
                document.getElementById("dlink").click();
            }
        })();

        //$("#dlink").click(function () {   // it also work please dont remove it (PTK)
        //    $("#tblExcel").table2excel({
        //        exclude: ".noExl",
        //        name: "原価集計表",
        //        filename: "原価集計表",
        //        fileext: ".xls"
        //    });
        //});
        function download() {
            $(document).find('tfoot').remove();
            var name = '原価集計表.xls';
            if ($('#tblExcel tbody tr').length > 0) {
                tableToExcel('tblExcel', '原価集計表', name);
               // document.getElementById("dlink").click();
                Swal.fire({
                    icon: 'success',
                    title: 'I204',
                    text: 'EXCEL出力が完了しました',
                })
            }
            $('#tblExcel thead tr').remove();
            $('#tblExcel tbody tr').remove();
        }

        function replaceZero(str) {
            if (str == 0)
                return str.toString().replace(0, '');
            else
                return str.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function commaSeparate(str) {
            if (str)
                return str.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            else
                return str;
        }

        function replaceNull(str) {
            if (str === null)
                return '';
            else
                return str;
        }
        //Excel Print//
    </script>
    @*<script type="text/javascript">
            function tableau(pid, iid, fmt, ofile) {
                if (typeof Downloadify !== 'undefined') Downloadify.create(pid, {
                    swf: 'downloadify.swf',
                    downloadImage: 'download.png',
                    width: 100,
                    height: 30,
                    filename: ofile, data: function () { return doit(fmt, ofile, true); },
                    transparent: false,
                    append: false,
                    dataType: 'base64',
                    onComplete: function () { alert('Your File Has Been Saved!'); },
                    onCancel: function () { alert('You have cancelled the saving of this file.'); },
                    onError: function () { alert('You must put something in the File Contents or there will be nothing to save!'); }
                }); else document.getElementById(pid).innerHTML = "";
            }
            tableau('xlsxbtn', 'xportxlsx', 'xlsx', 'SheetJSTableExport.xlsx');

        </script>*@
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-36810333-1']);
        _gaq.push(['_setDomainName', 'sheetjs.com']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
}