
@{
    ViewBag.Title = "Print_Genka";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/bootstrap-textbox.css")" />
}
<div id="divMain" class="container-fluid">
    <div class="content">
        <div class="p-5 row shadow" style="box-shadow: 0 .1rem .4rem rgba(0,0,0,.1) !important; background:white; border-radius:5px;">
            <div class="col-xs-12 col-md-2"></div>
            <div class="col-xs-12 col-md-8">
                <div>
                    <h2 class=" hr-text text-center">原価集計表</h2>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="1" class="text-line col-xl-5 text-left" id="targetyear" onkeydown="KeyDown(event,this)" placeholder="対象年度">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="2" class="text-line col-xl-5 text-left" id="BrandCD" name="brandname" onkeydown="KeyDown(event,this)" style="width:140px;" placeholder="ブランド名">
                            <label id="#"><b>ブランド表示</b></label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:20px;">シーズン</label>
                            <input type="checkbox" tabindex="3" id="allyear" name="chk" onkeydown="KeyDown(event,this)">
                            <label for="allyear" style="padding-right:20px!important;">通年</label>
                            <input type="checkbox" tabindex="4" id="SS" name="chk" onkeydown="KeyDown(event,this)">
                            <label for="SS" style="padding-right:20px!important;">SS</label>
                            <input type="checkbox" tabindex="5" id="FW" name="chk" onkeydown="KeyDown(event,this)">
                            <label for="FW" style="padding-right:20px!important;">FW</label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:20px;">プロジェクト</label>
                            <input type="text" tabindex="6" class="text-line col-xl-5 text-left" id="ProjectCD" name="projectname" onkeydown="KeyDown(event,this)" style="width:80px;">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:90px;"></label>
                            <input type="text" tabindex="7" class="text-line col-xl-5 text-left" onkeydown="KeyDown(event,this)">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:20px;">納品状況</label>
                            <input type="checkbox" tabindex="8" id="allyear" name="chk" onkeydown="KeyDown(event,this)">
                            <label for="allyear" style="padding-right:20px!important;">納品残あり</label>
                            <input type="checkbox" tabindex="9" id="SS" name="chk" onkeydown="KeyDown(event,this)">
                            <label for="SS" style="padding-right:20px!important;">完納</label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12" style="padding-left:110px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <button id="btnGenerate" tabindex="10" onclick="btnGenerateClick()" class="btn btn-dark col-xl-5 text-center"></button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="btnCancel" tabindex="11" onclick="btnCancelClick()" class="btn btn-primary col-xl-5 text-center">戻る</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-md-2"></div>
        </div>
    </div>
</div>
@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#formtitle").text("原価集計表");
            $("#txtYear").focus();
            var Mode = '@Model.Mode';
            if (Mode == 'New') {
                $('#btnGenerate').html('登録');

                RequiredCheck($("#txtYear"));
                YearCheck($("#txtYear"), '@Url.Action("Year_Checking", "api/CommonApi")');

                RequiredCheck($("#BrandCD"));
                @*DoubleByteCheck($("#BrandCD"), '@Url.Action("DoubleByte_Checking", "api/CommonApi")');*@
                ExistsCheck($("#BrandCD"), "Brand", '@Url.Action("M_Brand_ExistsCheck", "api/Print_GenkaApi")', "brandname");

                RequiredCheck($("#projectCD"));
                 @*DoubleByteCheck($("#projectCD"), '@Url.Action("DoubleByte_Checking", "api/CommonApi")');*@
                ExistsCheck($("#projectCD"), "Project", '@Url.Action("M_Project_ExistsCheck", "api/Print_GenkaApi")', "projectName");
            }
        });
        function btnGenerateClick(){
            var allyear = $("#allyear").is(":checked");
            var ss = $("#SS").is(":checked");
            var fw = $("#FW").is(":checked");
            if (!allyear && !ss && !fw) {
                $("#FW").focus();
                var data = ShowErrorMessage("E111");
                return data;
            }
           else {
                var res = ErrorCheckOnSave();
                if (res == "0") {
                    var pmodel = {
                        //need to write code 
                    };
                     if ($('#allyear').is(':checked'))
                         pmodel.Season = "1";
                         else if ($('#SS').is(':checked'))
                         pmodel.Season = "2";
                         else if ($('#FW').is(':checked'))
                         pmodel.Season = "3";
                    var data = CalltoApiController('@Url.Action("Print_GenkaCSV", "api/Print_GenkaApi")', pmodel);
                    var items = JSON.parse(response);
                    ExportToExcel(items, $("#AutoID option:selected").text() + today + ".xlsx", "Sheet1");
                }
                else {
                    $("#targetyear").focus();
                    ShowErrorMessage(res);
                }
            }
             
        }
    </script>
}