

@model Models.TourokuProjectModel
@{
    ViewBag.Title = "TourokuProject_Entry";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/bootstrap-textbox.css")" />
}


<div id="divMain" class="container-fluid">
    <div class="content">
        <div class="p-5 row shadow" style="box-shadow: 0 .1rem .4rem rgba(0,0,0,.1) !important; background:white; border-radius:5px;">
            <div class="col-xs-12 col-md-2"></div>
            <div class="col-xs-12 col-md-8">
                <div>
                    <h2 class=" hr-text text-center">プロジェクト登録</h2>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="1" class="text-line col-xl-5 text-left" onkeydown="KeyDown(event,this)" id="BrandCD" name="brandcd" maxlength="6" required placeholder="プロジェクトコード">

                            <input type="text" tabindex="2" class="text-line col-xl-5 text-left" onkeydown="KeyDown(event,this)" id="BrandName" name="brandname" maxlength="40" required placeholder="プロジェクト名">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="3" class="text-line col-xl-5 text-left" onkeydown="KeyDown(event,this)" id="Year" name="year" required placeholder="年度">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="4" class="text-line col-xl-5 text-left" style="width: 130px;" onkeydown="KeyDown(event,this)" id="BrandCode" name="brandcode" maxlength="4" required placeholder="ブランド">
                            <label id="" style="padding-left:80px;"><b>ブランド表示</b></label>

                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style=" padding-top:1.2rem!important;">
                    <div class="col-xl-12" style="padding-left: 0px">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <div class="custom-control custom-radio" style="padding-left:0px!important;">
                                <label class="text" style="padding-right:30px;">シーズン</label>
                                <input type="radio" id="rdoyear" name="radio" checked>
                                <label style="padding-right:40px;">通年</label>
                                <input type="radio" id="rdoss" name="radio">
                                <label style="padding-right:40px;">SS</label>
                                <input type="radio" id="rdofw" name="radio">
                                <label>FW</label>
                            </div>
                        </div>
                    </div>

                </div>
                <div>
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="6" class="text-line col-xl-4 text-left" onkeydown="KeyDown(event,this)" id="PeriodStart" name="periodstart" maxlength="7" required placeholder="予定期間">
                            <label class="col-xl-1" style="font-size: 1.8rem;">~</label>
                            <input type="text" tabindex="7" class="text-line col-xl-5 text-left" onkeydown="KeyDown(event,this)" id="PeriodEnd" name="periodend" maxlength="7" required placeholder="予定期間">

                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="Production" style="padding-right:20px;">総生産数</label>
                            <label id="Production" style="padding-right:30px;"><b>総生産数表示</b></label>
                            <label id="SalesPrice" style="padding-right:20px;">総金額</label>
                            <label id="SalesPrice"><b>総金額表示</b></label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="1" class="text-line col-xl-5 text-left" style="width:130px;" onkeydown="KeyDown(event,this)" id="UserName" name="username" maxlength="6" required placeholder="責任者">
                            <label id="SalesPrice" style="padding-left:80px;"><b>責任者表示</b></label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form">
                    <div class="col-xs-12">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="1" class="text-line col-xl-5 text-left" onkeydown="KeyDown(event,this)" id="AllocationCount" name="allocationcount" maxlength="6" required placeholder="配賦用固定値">

                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form">
                    <div class="col-xl-12 text-center">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <button id="btnSave" tabindex="7" onclick="btnSaveClick()" class="btn btn-dark col-xl-4 text-center">登録</button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="btnCancel" tabindex="8" onclick="btnCancelClick()" class="btn btn-primary col-xl-4 text-center">戻る</button>
                        </div>
                    </div>
                </div>
                <input type="hidden" id="APIURL" value="@Url.Action("M_Keihi_ExistsCheck", "api/TourokuProjectApi")" />
            </div>
            <div class="col-xs-12 col-md-3"></div>
        </div>
    </div>
</div>


@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#formtitle").text("プロジェクト登録");
            $("#ProjectCD").focus();
            var Mode = '@Model.Mode';
            if (Mode == 'New') {
                $('#btnSave').html('登録');
             
                RequiredCheck($("#ProjectCD"));
                RequiredCheck($("#ProjectName"));
                RequiredCheck($("#Year"));
                RequiredCheck($("#BrandCode"));
                RequiredCheck($("#PeriodStart"));
                RequiredCheck($("#PeriodEnd"));
                AlreadyExistsCheck($("#ProjectCD"), "Project", '@Url.Action("M_Project_ExistsCheck", "api/TourokuProjectApi")');
                ExistsCheck($("#KanjoCD"), "Kanjo", '@Url.Action("M_Kanjo_ExistsCheck", "api/KeihiSetteiApi")', "KanjoName");
            }
            @*else if (Mode == 'Edit') {
                $('#btnSave').html('更新');
                $("#CostCD").attr('disabled', 'disabled');
                $("#CostName").focus();
                $("#HojoCD").attr('disabled', 'disabled');

                RequiredCheck($("#CostName"));
                RequiredCheck($("#KanjoCD"));
                ExistsCheck($("#KanjoCD"), "Kanjo", '@Url.Action("M_Kanjo_ExistsCheck", "api/KeihiSetteiApi")', "KanjoName");
                ShowData();
            }
            else  {
                $('#btnSave').html('削除');
                $("#CostCD").attr('disabled', 'disabled');
                $("#CostName").attr('disabled', 'disabled');
                $("#KanjoCD").attr('disabled', 'disabled');
                $("#HojoCD").attr('disabled', 'disabled');
                $("#Accounting").attr('disabled', 'disabled');
                $("#Allocation").attr('disabled', 'disabled');
                $("#btnSave").focus();
                ShowData();
            }
        });

            //set data
        function ShowData() {
            var Kmodel = {
                CostCD: '@Model.CostCD',
            };
            var data = CalltoApiController('@Url.Action("M_Keihi_Select_Entry", "api/KeihiSetteiApi")', Kmodel);
            var keihidata = JSON.parse(data);
            $("#CostCD").val(keihidata[0].CostCD);
            $("#CostName").val(keihidata[0].CostName);
            $("#KanjoCD").val(keihidata[0].KanjoCD);
            $("#HojoCD").val(keihidata[0].HojoCD);

            if (!keihidata[0].KanjoName)
                $("#KanjoName").text("勘定科目表示");
            else $("#KanjoName").text(keihidata[0].KanjoName);

            if (!keihidata[0].HojoName)
                $("#HojoName").text("補助科目表示");
            else $("#HojoName").text(keihidata[0].HojoName);

            //Bind Accounting
            if (keihidata[0].Accounting == "1")
                $("#rdoDCost").prop("checked", true);
            else if (keihidata[0].Accounting == "2")
                $("#rdoBrandSeason").prop("checked", true);
            else if (keihidata[0].Accounting == "3")
                $("#rdoProject").prop("checked", true);
            else if (keihidata[0].Accounting == "4")
                $("#rdoMAllocation").prop("checked", true);
            else
                $("#rdoFItems").prop("checked", true);

            //Bind Allocation
            if (keihidata[0].Allocation == "0")
                $("#rdoDirectly").prop("checked", true);
            else if (keihidata[0].Allocation == "1")
                $("#rdoTMRatio").prop("checked", true);
            else if (keihidata[0].Allocation == "2")
                $("#rdoPNRatio").prop("checked", true);
            else
                $("#rdoFVRatio").prop("checked", true);

            $("#KanjoName").css("font-weight", "Bold");
            $("#HojoName").css("font-weight", "Bold");
        }

        function DoProcess() {
            focusControl = $("#CostCD");
             var Kmodel = {
                 CostCD: $("#CostCD").val(),
                 CostName: $("#CostName").val(),
                 KanjoCD: $("#KanjoCD").val(),
                 HojoCD: $("#HojoCD").val(),
                 Accounting: $("#Accounting").val(),
                 Allocation: $("#Allocation").val(),
                 Mode:'@Model.Mode'
            };

            //For Accounting
            if ($('#rdoDCost').is(':checked'))
                Kmodel.Accounting = "1";
            else if ($('#rdoBrandSeason').is(':checked'))
                Kmodel.Accounting = "2";
            else if ($('#rdoProject').is(':checked'))
                Kmodel.Accounting = "3";
            else if ($('#rdoMAllocation').is(':checked'))
                Kmodel.Accounting = "4";
            else Kmodel.Accounting = "5";

            //For Allocation
            if ($('#rdoDirectly').is(':checked'))
                Kmodel.Allocation = "0";
            else if ($('#rdoTMRatio').is(':checked'))
                Kmodel.Allocation = "1";
            else if ($('#rdoPNRatio').is(':checked'))
                Kmodel.Allocation = "2";
            else Kmodel.Allocation = "3";

            var data = CalltoApiController('@Url.Action("Keihi_CUD", "api/KeihiSetteiApi")', Kmodel);
            ShowSuccessMessage(data,'@Url.Action("KeihiSetteiList", "KeihiSettei")');
        }

        function KanjoCheck(result) {
            if (result == 'OK') {
                if ($("#TmpVal1").val() == "1") {
                    $("#HojoCD").prop("disabled", false);
                    $("#HojoCD").focus();
                    RequiredCheck($("#HojoCD"));
                    ExistsCheck($("#HojoCD"), "Hojo", '@Url.Action("M_Hojo_ExistsCheck", "api/KeihiSetteiApi")', "HojoName", $("#KanjoCD").val());
                }
                else {
                    $("#HojoCD").prop("disabled", true);
                    RemoveRequired($("#HojoCD"));
                    RemoveExistCheck($("#HojoCD"));
                    $("#HojoCD").val('');
                    $("#HojoName").text('補助科目表示');
                }
            }
            else {
                $("#KanjoCD").focus();
                $("#KanjoName").text('勘定科目表示');
                $("#HojoCD").val('');
                $("#HojoName").text('補助科目表示');
                $("#HojoCD").prop("disabled", true);
            }
            $("#KanjoName").css("font-weight", "Bold");
            $("#HojoName").css("font-weight", "Bold");
        }

        function HojoCheck(result) {
            if (result == 'OK') {
                $("#Accounting").focus();
            }
            else {
                $("#HojoName").text('補助科目表示');
                $("#HojoCD").focus();
            }
            $("#HojoName").css("font-weight", "Bold");
        }


        function DeleteConfrim() {
            DoProcess();
        }

        //save
        function btnSaveClick() {
            var res = ErrorCheckOnSave();
            if (res == "0") {
                var Mode = '@Model.Mode';
                //show confirm message
                if (Mode == "Delete") {
                    ShowConfirmMessage("Q102", "DeleteConfrim");
                }
                else {
                    DoProcess();
                }
            }
            else
                ShowErrorMessage(res);
        }*@

        @*function btnCancelClick() {
            location.href = '@Url.Action("TourokuProject_List", "TourokuProject")';
        }*@

    </script>
    <script src="@Url.Content("~/Scripts/datepicker.js")"></script>
    <script src="@Url.Content("~/Scripts/datepicker.en.js")"></script>
   
}

