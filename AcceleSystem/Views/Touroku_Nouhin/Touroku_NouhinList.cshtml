@model Models.TourokuNouhinModel
@{
    ViewBag.Title = "Touroku_NouhinList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/bootstrap-textbox.css")" />
}

<div id="divMain" class="container-fluid">
    <div class="content">
        <div class="p-5 row shadow" style="box-shadow: 0 .1rem .4rem rgba(0,0,0,.1) !important; background:white; border-radius:5px;">
            <div class="col-xs-6 col-md-4">
                <div class="pt-3 md-form">
                    <button id="btnAdd" onclick="btnNouhinEntry_Click()" class="btn" tabindex="38" style="background-color:#1a8cff; color:azure; border:1px solid transparent; border-radius: 3px; margin-right: 20px;">
                        納品追加
                    </button>
                    <button id="btnAdd" onclick="btnB/SNouhin_Click()" class="btn" tabindex="38" style="background-color:#1a8cff; color:azure; border:1px solid transparent; border-radius: 3px; margin-right: 20px;">
                        B/S一括納品
                    </button>
                    <button id="btnAdd" onclick="btnDelete_Click()" class="btn" tabindex="38" style="background-color:white; color:#1a8cff; border-radius:3px; border: 1px solid transparent; border-color:#1a8cff; margin-right: 20px;">
                        削除
                    </button>
                </div>
                <div class="pt-3 md-form">
                    <h4 class=" hr-text text-center">検索条件入力</h4>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xl-12" style="padding-left:65px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:10px;">年度</label>
                            <input type="text" tabindex="1" id="Year" name="txtYear" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="4" required placeholder="入力" style="width:110px;">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xl-12" style="padding-left:17px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:10px;">ブランド名</label>
                            <input type="text" tabindex="2" id="BrandCD" name="txtBrandCD" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="20" required placeholder="入力" style="width:110px;">
                            <input type="text" tabindex="3" id="BrandName" name="txtBrandName" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="40" required placeholder="入力" style="width:110px;">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xl-12" style="padding-left:30px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label class="text" style="padding-right:15px;">シーズン</label>
                            <input type="checkbox" tabindex="4" id="Allyear" name="chkAllyear" checked>
                            <label style="padding-right:50px;">度年</label>
                            <input type="checkbox" id="SS" name="chkSS">
                            <label style="padding-right:50px;">SS</label>
                            <input type="checkbox" id="FW" name="chkFW">
                            <label>FW</label>
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xl-12" style="padding-left:1px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:9px;">プロジェクト</label>
                            <input type="text" tabindex="5" id="ProjectCD" name="txtProjectCD" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="10" required placeholder="入力" style="width:110px;">

                        </div>
                    </div>
                    <div class="col-xl-12" style="padding-left:110px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <input type="text" tabindex="6" id="ProjectName" name="txtProjectName" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="60" required placeholder="入力" style="width:110px;">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xl-12" style="padding-left:63px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:10px;">品番</label>
                            <input type="text" tabindex="7" id="HinbanCD" name="txtHinbanCD" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="10" required placeholder="入力" style="width:110px;">
                            <input type="text" tabindex="8" id="HinbanName" name="txtHinbanName" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="60" required placeholder="入力" style="width:110px;">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="col-xl-12" style="padding-left:50px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label id="text" style="padding-right:10px;">納品目</label>
                            <input type="text" tabindex="9" id="StartDate" name="txtStartDate" onkeydown="KeyDown(event,this)" class="text-line text-left" maxlength="10" required placeholder="入力" style="width:110px;">
                            &nbsp;~&nbsp;
                            <input type="text" tabindex="10" id="EndDate" name="txtEndDate" onkeydown="KeyDown(event,this,'CompareDate')" class="text-line text-left" maxlength="10" required placeholder="入力" style="width:110px;">
                        </div>
                    </div>
                </div>
                <div class="pt-3 md-form" style="padding-top:1.2rem!important;">
                    <div class="ccol-xl-12" style="padding-left:30px;">
                        <div class="text-s text-custom1 text-uppercase mb-1">
                            <label class="text" style="padding-right:12px;">納品状況</label>
                            <input type="checkbox" tabindex="11" id="Delleft" name="chkDelleft" checked>
                            <label style="padding-right:50px;">納品残あり</label>
                            <input type="checkbox" id="Delcomplete" name="chkDelcomplete">
                            <label style="padding-right:50px;">完納</label>
                        </div>
                    </div>
                </div>
                <div class="col-xl-12" style="padding-left:0px; padding-top:2rem;">
                    <div class="text-s text-custom1 text-uppercase mb-1">
                        <button id="btnSearch" tabindex="12" onclick="btnSearchClick()" class="btn btn-dark col-xl-4 text-center" style="float:right; width:100px;">検索</button>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                    </div>
                </div>
            </div>

            <div class="col-lg-5 col-sm-12">
                <div class="card-body card-block">
                    <table id="tblNouhin" class="tb1 col-sm-12" style="padding-left:0px;">
                        <thead>
                            <tr>
                                <th>納品日</th>
                                <th>ブランド</th>
                                <th>シーズン</th>
                                <th>年度</th>
                            </tr>
                            <tr>
                                <th>プロジェクト</th>
                            </tr>
                            <tr>
                                <th>品番</th>
                                <th></th>
                                <th>生産数</th>
                                <th>納品数</th>
                            </tr>
                            <tr>
                                <td>DeliveryDate</td>
                                <td>Brand</td>
                                <td>Season</td>
                                <td>Year</td>
                            </tr>
                            <tr>
                                <td>Project</td>
                            </tr>
                            <tr>
                                <td>Hinban</td>
                                <td></td>
                                <td>Production</td>
                                <td>DeliveryAmount</td>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="col-lg-3 col-sm-12">
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#formtitle").text("納品履歴検索");
           // YearMonthCheck($("#Year"), '@Url.Action("YearMonth_Checking", "api/CommonApi")');
            ExistsCheck($("#BrandCD"), "Brand", '@Url.Action("M_Brand_ExistsCheck", "api/BrandApi")', "BrandName");
            ExistsCheck($("#ProjectCD"), "Project", '@Url.Action("M_Project_ExistsCheck", "api/TourokuProjectApi")', "ProjectName");
            ExistsCheck($("#HinbanCD"), "Hinban", '@Url.Action("M_HinBan_ExistsCheck", "api/TourokuProjectApi")', "HinbanName");
            DateCheck($("#StartDate"), '@Url.Action("Date_Checking", "api/CommonApi")');
            $("#BrandName").attr('disabled', 'disabled');
            $("#ProjectName").attr('disabled', 'disabled');
            $("#HinbanName").attr('disabled', 'disabled');
            GetNouhin();
            $("#Year").focus();
        });

        function CompareDate(result) {
            if (result == 'OK') {
                DateCheck($("#EndDate"), '@Url.Action("Date_Checking", "api/CommonApi")', "1", $("#StartDate").val());
            }
        }

        //function btnSearchClick() {
        //    alert("a");
        //    var res = ErrorCheckOnSave();
        //    if (res == "0") {
        //        alert("b");
        //        GetNouhin();
        //    }
        //    else {
        //        ShowErrorMessage(res);
        //    }
        //}

        function GetNouhin() {
            var TnModel = {
                Year: $("#Year").val(),
                BrandCD: $("#BrandCD").val(),
                BrandName: $("#BrandName").val(),
                ProjectCD: $("#ProjectCD").val(),
                ProjectName: $("#ProjectName").val(),
                HinbanCD: $("#HinbanCD").val(),
                HinbanName: $("#HinbanName").val(),
                DeliveryStartDate: $("#DeliveryStartDate").val(),
                DeliveryEndDate: $("#DeliveryEndDate").val()
            };
            if ($('#Allyear').is(':checked'))
                TnModel.Season = "1";
            else if ($('#SS').is(':checked'))
                TnModel.Season = "2";
            else TnModel.Season = "3";

            if ($('#Delleft').is(':checked'))
                TnModel.DeliveryStatus = "1";
            else TnModel.DeliveryStatus = "2";
            
            $.ajax({
            type: "Post",
            url:"@Url.Action("D_Delivery_Search", "api/Touroku_NouhinApi")",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(TnModel),
            headers:
            {
                Authorization: 'Basic ' + btoa('Capital_MM' + ':' + 'CKM12345!')
            },
            success: function (response) {
                    BindTable(response);
                }
            });

            @*$.ajax({
                type: "Post",
                url:"@Url.Action("D_Delivery_Search", "api/Touroku_NouhinApi")",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(TnModel),
                headers:
                {
                    Authorization: 'Basic ' + btoa('Capital_MM' + ':' + 'CKM12345!')
                },
                success: function (response) {
                        BindTable(response);
                    }
            });*@
        }

        function BindTable(response) {
            table = $('#tblNouhin').DataTable({

                data: JSON.parse(response),
                "bFilter": false,
                "bLengthChange": false,
                "bInfo": false,
                destroy:true,
                "columns": [
                    {
                        "data": null,
                        className:"Border1",
                        render: function (data, type, row) {
                            return '<label>' + data.DeliveryDate + '</label><label>' + data.BrandName + '</label><label>' + data.Season + '</label><label>' + data.Year + '</label>';
                        }
                    },
                    {
                        "data": null,
                        className: "Border2",
                        render: function (data, type, row) {
                            return '<label>' + data.ProjectCD + '</label><label>' + data.ProjectName +  '</label>';
                        }
                    },
                    {
                        "data": null,
                        className: "Border2",
                        render: function (data, type, row) {
                            return '<label>' + data.HinbanCD + '</label><label>' + data.HinbanName + '</label><label></label><label>' + data.Production + '</label><label>' + data.DeliveryAmount + '</label>';
                        }
                    },
                    {
                        "data": null,
                        className: "Border3",
                        render: function (data, type, row) {
                            return '<label><a href="#" onClick="btnEditClick(\'' + data.CostCD + '\')" style="color:blue">編集</a></label><br/><label><a href="#" onClick="btnDelClick(\'' + data.CostCD +'\')" style="color:red">削除</a></label>';
                        }
                    },
                ],
                "drawCallback": function (settings) {
                    $("#tblNouhin thead").remove();
                }
            });
        }

    @*function btnAddClick() {
        location.href = '@Url.Action("KeihiSetteiEntry", "KeihiSettei")?Mode=New'
    }

    function btnEditClick(CostCD) {
        location.href = '@Url.Action("KeihiSetteiEntry", "KeihiSettei")?CostCD='+CostCD+'&Mode=Edit';
    }

    function btnDelClick(CostCD) {
        location.href = '@Url.Action("KeihiSetteiEntry", "KeihiSettei")?CostCD='+CostCD+'&Mode=Delete';
        }*@
    </script>

    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/datatables.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/dataTables.bootstrap.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/dataTables.buttons.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/buttons.bootstrap.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/jszip.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/vfs_fonts.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/buttons.html5.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/buttons.print.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/lib/data-table/buttons.colVis.min.js")"></script>
    <script src="@Url.Content("~/ElaAdmin/assets/js/init/datatables-init.js")"></script>

}