@{
    ViewBag.Title = "Test";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
}

<div class="limiter">
    <div class="container-login100">
        <div class="wrap-login100">
            <div class="login100-pic js-tilt" data-tilt>
                <img src="@Url.Content("~/ElaAdmin/images/img-01.png")" alt="IMG">
            </div>

            <form id="f1">
                <span class="login100-form-title">
                    Acceleシステム
                </span>

                <div class="wrap-input100 validate-input">
                    <input id="UserID" class="input100" type="text" name="user" required placeholder="User ID">
                    <span class="symbol-input100">
                        <i class="fas fa-user-circle" aria-hidden="true"></i>
                    </span>
                </div>

                <div class="wrap-input100 validate-input">
                    <input id="Password" class="input100" type="password" name="pass" required placeholder="Password">
                    <span class="symbol-input100">
                        <i class="fa fa-lock" aria-hidden="true"></i>
                    </span>
                </div>

                <div class="container-login100-form-btn">
                    <button id="btnLogin" onclick="btnLoginClick()" class="login100-form-btn">
                        ログイン
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {

        });

        //prevent default submit
        $("#f1").submit(function (e) {
            return false;
        });

        function btnLoginClick() {

            var Umodel = {
                UserID: $('#UserID').val(),
                Password: $('#Password').val()
            };

            $.ajax({
                url: '@Url.Action("UserLogin_Select", "api/UserApi")',
                method: 'POST',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(Umodel),
                headers:
                {
                    Authorization: 'Basic ' + btoa('Capital_MM' + ':' + 'CKM12345!')
                },  
                success: function (data) {
                    var userdata = JSON.parse(data);
                    var userinfo = userdata[0].UserID + '_' + userdata[0].UserName
                    if (data.length > 0) {
                        $.post('/Home/CreateSession', 
                        { key : "UserInfo", value : userinfo }, function (data) 
                        {
                            window.location.replace('@Url.Action("Dashboard", "Home")');
                        });
                    }                   
                },
                error: function (data) {
                    alert("Request failed: " + data);
                }
            });
        }

    </script>
}